<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - Profile Builder</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <!-- Remove old navbar - it will be inserted by navbar.js -->
    
    <!-- Keep all existing content below -->
    <main>
        <div id="publicProfile" class="public-profile">
            <!-- Keep all existing profile content -->
        </div>
    </main>

    <script src="/components/navbar.js"></script>
    <script src="/js/scripts.js"></script>
    <script>
        // Function to load public profile
        async function loadPublicProfile() {
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('id');
            
            if (!userId) {
                window.location.href = '/explore.html';
                return;
            }

            try {
                const response = await fetch(`/api/users/${userId}/public`);
                const userData = await response.json();
                
                const profileContainer = document.getElementById('publicProfile');
                profileContainer.innerHTML = `
                    <div class="public-profile-header" data-profile-type="${userData.profile_type}">
                        <div class="profile-image-large">
                            ${userData.profile_image ? 
                                `<img src="${userData.profile_image}" alt="${userData.display_name || userData.username}">` :
                                userData.display_name?.charAt(0).toUpperCase() || userData.username?.charAt(0).toUpperCase() || 'üë§'
                            }
                        </div>
                        <h1 class="${userData.profile_type === 'brand' ? 'brand-name' : ''}">
                            ${userData.display_name || userData.username}
                            <span class="user-type-badge ${userData.profile_type}">
                                ${userData.profile_type === 'brand' ? 'üè¢' : 'üé®'}
                            </span>
                        </h1>
                        <p class="bio">${userData.bio || 'No bio available'}</p>
                    </div>

                    <div class="profile-actions">
                        <button onclick="viewProjects()" class="profile-action-btn">View Projects</button>
                    </div>

                    <div class="public-profile-content" data-profile-type="${userData.profile_type}">
                        ${userData.profile_type === 'creator' ? `
                            <!-- Creator Content -->
                            <section class="profile-section">
                                <h3>Metrics</h3>
                                <div class="metrics-grid">
                                    <div class="metric">
                                        <span class="metric-icon">üë•</span>
                                        <span class="metric-value">${userData.follower_count?.toLocaleString() || 0}</span>
                                        <span class="metric-label">Followers</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-icon">üëÅÔ∏è</span>
                                        <span class="metric-value">${userData.view_count?.toLocaleString() || 0}</span>
                                        <span class="metric-label">Views</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-icon">‚≠ê</span>
                                        <span class="metric-value">${userData.account_watchers?.toLocaleString() || 0}</span>
                                        <span class="metric-label">Watchers</span>
                                    </div>
                                </div>
                            </section>

                            <section class="profile-section">
                                <h3>Specialties</h3>
                                <div class="tag-container">
                                    ${Array.isArray(userData.creator_specialties) ? 
                                        userData.creator_specialties.map(specialty => {
                                            let icon;
                                            switch(specialty.toLowerCase()) {
                                                case 'gaming':
                                                    icon = 'üéÆ';
                                                    break;
                                                case 'beauty':
                                                    icon = 'üíÑ';
                                                    break;
                                                case 'tech':
                                                    icon = 'üíª';
                                                    break;
                                                case 'food':
                                                    icon = 'üç≥';
                                                    break;
                                                case 'fitness':
                                                    icon = 'üí™';
                                                    break;
                                                case 'travel':
                                                    icon = '‚úàÔ∏è';
                                                    break;
                                                case 'fashion':
                                                    icon = 'üëó';
                                                    break;
                                                case 'music':
                                                    icon = 'üéµ';
                                                    break;
                                                default:
                                                    icon = '‚ú®';
                                            }
                                            return `<span class="tag specialty-tag"><i>${icon}</i>${specialty}</span>`;
                                        }).join('') : 'No specialties listed'
                                    }
                                </div>
                            </section>

                            <section class="profile-section">
                                <h3>Content & Platforms</h3>
                                <h4>Platforms</h4>
                                <div class="tag-container">
                                    ${Array.isArray(userData.creator_platforms) ? 
                                        userData.creator_platforms.map(platform => {
                                            let icon, className;
                                            switch(platform.toLowerCase()) {
                                                case 'youtube':
                                                    icon = '‚ñ∂Ô∏è';
                                                    className = 'youtube';
                                                    break;
                                                case 'instagram':
                                                    icon = 'üì∏';
                                                    className = 'instagram';
                                                    break;
                                                case 'tiktok':
                                                    icon = 'üéµ';
                                                    className = 'tiktok';
                                                    break;
                                                case 'twitter':
                                                    icon = 'üê¶';
                                                    className = 'twitter';
                                                    break;
                                                case 'twitch':
                                                    icon = 'üéÆ';
                                                    className = 'twitch';
                                                    break;
                                                default:
                                                    icon = 'üåê';
                                                    className = '';
                                            }
                                            return `<span class="tag platform-tag ${className}"><i>${icon}</i>${platform}</span>`;
                                        }).join('') : 'No platforms listed'
                                    }
                                </div>
                                
                                <h4>Content Types</h4>
                                <div class="tag-container">
                                    ${Array.isArray(userData.content_types) ? 
                                        userData.content_types.map(type => {
                                            let icon, className;
                                            switch(type.toLowerCase()) {
                                                case 'video':
                                                    icon = 'üé•';
                                                    className = 'video';
                                                    break;
                                                case 'photo':
                                                    icon = 'üì∏';
                                                    className = 'photo';
                                                    break;
                                                case 'blog':
                                                    icon = '‚úçÔ∏è';
                                                    className = 'blog';
                                                    break;
                                                case 'podcast':
                                                    icon = 'üéôÔ∏è';
                                                    className = 'podcast';
                                                    break;
                                                case 'stream':
                                                    icon = 'üì∫';
                                                    className = 'stream';
                                                    break;
                                                default:
                                                    icon = 'üìù';
                                                    className = '';
                                            }
                                            return `<span class="tag content-tag ${className}"><i>${icon}</i>${type}</span>`;
                                        }).join('') : 'No content types listed'
                                    }
                                </div>
                            </section>

                            <section class="profile-section">
                                <h3>Deal Information</h3>
                                <div class="info-grid">
                                    <div class="info-card">
                                        <div class="info-icon">üí∞</div>
                                        <div class="info-value">${userData.budget_range || 'Not specified'}</div>
                                        <div class="info-label">Budget Range</div>
                                    </div>
                                    <div class="info-card">
                                        <div class="info-icon">üéØ</div>
                                        <div class="info-value">${userData.market_size || 'Not specified'}</div>
                                        <div class="info-label">Market Size</div>
                                    </div>
                                    <div class="info-card">
                                        <div class="info-icon">üë•</div>
                                        <div class="info-value">${userData.company_size_range || 'Not specified'}</div>
                                        <div class="info-label">Company Size</div>
                                    </div>
                                </div>
                            </section>

                            <section class="profile-section">
                                <h3>Portfolio & Links</h3>
                                <div class="portfolio-links">
                                    ${Array.isArray(userData.portfolio_links) ? 
                                        userData.portfolio_links.map(link => {
                                            const url = new URL(link);
                                            return `<a href="${link}" target="_blank" class="portfolio-link">${url.hostname}</a>`;
                                        }).join('') : 'No portfolio links available'
                                    }
                                </div>
                            </section>
                        ` : `
                            <!-- Brand Content -->
                            <section class="profile-section">
                                <h3>Brand Information</h3>
                                <p class="brand-description">${userData.brand_description || 'No description available'}</p>
                                
                                <h4>Industry Sectors</h4>
                                <div class="tag-container">
                                    ${Array.isArray(userData.industry_sectors) ? 
                                        userData.industry_sectors.map(sector => 
                                            `<span class="tag industry-tag">${sector}</span>`
                                        ).join('') : 'No sectors listed'
                                    }
                                </div>
                            </section>

                            <section class="profile-section">
                                <h3>Target Audience</h3>
                                <div class="tag-container">
                                    ${Array.isArray(userData.target_demographics) ? 
                                        userData.target_demographics.map(demo => 
                                            `<span class="tag demographic-tag">${demo}</span>`
                                        ).join('') : 'No demographics specified'
                                    }
                                </div>
                            </section>

                            <section class="profile-section">
                                <h3>Campaign Information</h3>
                                <h4>Goals</h4>
                                <div class="tag-container">
                                    ${Array.isArray(userData.campaign_goals) ? 
                                        userData.campaign_goals.map(goal => 
                                            `<span class="tag goal-tag">${goal}</span>`
                                        ).join('') : 'No campaign goals listed'
                                    }
                                </div>
                                
                                <h4>Budget Range</h4>
                                <p class="budget-range">${userData.budget_range || 'Not specified'}</p>
                            </section>
                        `}
                    </div>
                `;
            } catch (error) {
                console.error('Error loading public profile:', error);
            }
        }

        // Call both functions on page load
        document.addEventListener('DOMContentLoaded', () => {
            // This will handle the navbar profile pic and settings
            initializeNavbar();
            // This will load the public profile content
            loadPublicProfile();
        });

        // Add this function to initialize navbar
        function initializeNavbar() {
            const token = localStorage.getItem('token');
            const profilePic = document.querySelector('.profile-pic');
            const settingsMenu = document.querySelector('.settings-menu');

            if (profilePic && token) {
                // Get logged-in user's profile data
                fetch('/api/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => response.json())
                .then(userData => {
                    if (userData.profile_image) {
                        profilePic.innerHTML = `<img src="${userData.profile_image}" alt="Profile">`;
                    } else {
                        let userEmoji = localStorage.getItem('userEmoji');
                        if (!userEmoji) {
                            userEmoji = avatarEmojis[Math.floor(Math.random() * avatarEmojis.length)];
                            localStorage.setItem('userEmoji', userEmoji);
                        }
                        profilePic.innerHTML = userEmoji;
                    }

                    // Add click handler for profile pic
                    const tokenData = JSON.parse(atob(token.split('.')[1]));
                    profilePic.addEventListener('click', () => {
                        window.location.href = `/public-profile.html?id=${tokenData.id}`;
                    });
                })
                .catch(error => {
                    console.error('Error fetching profile:', error);
                    profilePic.innerHTML = avatarEmojis[Math.floor(Math.random() * avatarEmojis.length)];
                });
            }
        }
    </script>
</body>
</html> 